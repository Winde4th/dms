{# src/Actency/DMSBundle/Resources/views/Site/list.html.twig #}

{% extends '::base.html.twig' %}

{% block title %}Sites status{% endblock %}
{% block page_title %}Sites status{% endblock %}

{% block content %}
    {{ parent() }}
    <table class="sites-list">
        <caption>Sites status</caption>
        <thead>
            <th class="site-status">Status</th>
            <th class="site-name">Sites</th>
            <th class="site-core">Core version</th>
            <th class="site-updates">Updates</th>
            <th class="site-languages">Languages</th>
            <th class="site-features">Features</th>
            <th class="site-users">Users</th>
            <th class="site-nodes">Nodes</th>
            <th class="site-hacked">Hacked</th>
            <th class="site-w3c">W3C</th>
            <th class="site-actions">Actions</th>
        </thead>
        {% for site in sites_list %}
            {% set latency = sites_reports[site.id]['latency'] %}
            <tr class="site-row {% if latency == -1 %}site-disabled{% else %}site-enabled{% endif %}">
                <td class="site-status">
                    {% if latency == -1 %}
                        {{ label_danger('Ping Down') }}
                    {% else %}
                        {{ label_success('Ping Up') }} Latency: {{ label_info(latency ~ 'ms') }}
                    {% endif %}
                </td>
                <td class="site-name"><a href="{{ site.url }}" target="_blank">{{ site.url }}</a></td>
                {% set report = sites_reports[site.id]['report'] %}
                {% if report['code'] is defined and report['code'] == 1 %}
                    <td class="site-core">
                    {% if report['updates']['drupal']['type'] is defined %}
                        {% if report['updates']['drupal']['type'] == 'security' %}
                            <label>Current Version</label> {{ label_danger(report['updates']['drupal']['installed_version']) }}
                        {% else %}
                            <label>Current Version</label> {{ label_warning(report['updates']['drupal']['installed_version']) }}
                        {% endif %}
                        <br/><label>Recommended</label> {{ label_primary(report['updates']['drupal']['recommended_version']) }}
                    {% else %}
                        <label>Current Version</label> {{ label_info(report['system_status'][0]['value']) }}
                    {% endif %}
                    </td>
                    <td class="site-updates">
                        {% if report['updates']['uptodate'] is defined %}
                            Up to date
                        {% else %}
                            {% if report['updates']['security'] is defined %}
                                {{ label_danger(report['updates']['security']|length) }}
                            {% endif %}
                            {% if report['updates']['recommended'] is defined %}
                                {{ label_warning(report['updates']['recommended']|length) }}
                            {% endif %}
                        {% endif %}
                    </td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td></td>
                {% else %}
                    <td colspan="9">{{ label_warning('Connection refused') }} This site does not respond to report request... Check your <a href="{{ path('actency_edit_site', {'site': site.getId}) }}">secret key configuration</a> and try again !</td>
                {% endif %}
            </tr>
        {% endfor %}
    </table>
{% endblock %}